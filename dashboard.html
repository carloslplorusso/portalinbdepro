<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    </title>

    <script>
        // Detectar si es dispositivo m√≥vil o pantalla peque√±a
        if (window.matchMedia("(max-width: 768px)").matches || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            if (!window.location.href.includes("mobile.html")) {
                window.location.href = "mobile.html" + window.location.search;
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Toastify -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>

<body>

    <div id="password-alert-container"></div>

    <div class="lab-container">
        <header class="header-area">
            <h1 class="lab-title" id="lab-title-desktop">INBDE PRO <span
                    style="opacity:0.5; font-weight:300;">Lab</span></h1>
            <div class="lab-subtitle">Train in our lab. Become a Pro.</div>
            <div id="header-welcome-section">
                <div class="user-welcome">
                    <span>Welcome, <span .learning-card:active { transform: scale(0.98); border-color: var(--accent); }
                            .pomo-accordion-btn { background: #1c1c1c; color: #ccc; width: 100%; padding: 15px; border:
                            1px solid #333; border-radius: 12px; margin: 15px 0 5px 0; cursor: pointer; text-align:
                            left; font-weight: 600; display: flex; justify-content: space-between; align-items: center;
                            transition: all 0.3s; } .pomo-accordion-btn:hover { border-color: var(--accent); color:
                            white; } .pomo-accordion-content { background: #111; border: 1px solid #222; border-top:
                            none; border-radius: 0 0 12px 12px; padding: 20px; color: #ccc; font-size: 0.95rem;
                            line-height: 1.6; margin-bottom: 15px; max-height: 400px; /* Scrollable if too long */
                            overflow-y: auto; border-top: 1px solid #333; /* Visual separation */ margin-top: -10px; /*
                            Connect with button */ } .pomo-accordion-content h4 { color: white; margin: 15px 0 5px 0; }
                            .pomo-accordion-content ul { padding-left: 20px; margin-top: 5px; } .pomo-accordion-content
                            li { margin-bottom: 8px; }font-weight:700;">Doctor</span></span>
                    <button id="btn-logout-desktop"
                        style="background:none; border:1px solid #ff6b6b; color:#ff6b6b; border-radius:50%; width:24px; height:24px; cursor:pointer; font-size:10px; display:flex; align-items:center; justify-content:center;">‚úï</button>
                </div>
                <div class="stat-badge" id="countdown-badge" style="cursor: pointer;">
                    üìÖ Set Exam Date
                </div>
            </div>
        </header>

        <div id="dashboard-content">

            <div class="col-side col-left">
                <div class="card card-promo-style">
                    <div class="promo-header">
                        <div class="fire-icon">üî•</div>
                        <div class="promo-title">RANDOM LAB RUN</div>
                    </div>
                    <div class="promo-desc">10 random questions. Always fresh.</div>
                    <button class="btn-start" id="btn-daily-run">START NOW</button>
                </div>
                <div class="card card-notes square-card-bottom" id="card-notes-desktop">
                    <div class="metrics-header"><span class="metrics-title">QUICK NOTES</span><span>üìù</span></div>
                    <div style="font-size:0.8rem; opacity:0.5; margin-top:10px;">Click to open notebook...</div>
                </div>
            </div>

            <div class="col-center">
                <div class="card-learn-banner">
                    <div class="banner-icon">‚ú®</div>
                    <h2>Learn about the INBDE our way</h2>
                </div>

                <div class="center-row-hero">
                    <div class="hero-card" id="card-learning-lab">
                        <div class="icon">üß™</div>
                        <div class="title">Learning Lab</div>
                        <div class="sub">Study Mode</div>
                    </div>
                    <div class="hero-card" id="card-simulation-lab">
                        <div class="icon">‚è±</div>
                        <div class="title">Simulation</div>
                        <div class="sub">Exam Mode</div>
                    </div>
                    <div class="hero-card" id="card-pomodoro-lab">
                        <div class="icon">üçÖ</div>
                        <div class="title">Pomodoro</div>
                        <div class="sub">Focus Timer</div>
                    </div>
                </div>

                <div class="card card-metrics square-card-bottom" onclick="window.location.href='stats.html'">
                    <div class="metrics-header">
                        <span class="metrics-title">PERFORMANCE</span>
                        <span style="font-size:0.8rem; color:var(--accent);">View Stats ‚Üí</span>
                    </div>
                    <div class="pie-container"
                        style="display:flex; justify-content:center; align-items:center; height:100%;">
                        <div style="font-size: 3.5rem; filter: drop-shadow(0 0 10px rgba(250, 204, 21, 0.4));">
                            üìä
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-side col-right">
                <div class="card card-promo-style" id="card-ia-lab">
                    <div class="promo-header">
                        <div class="ai-icon">ü§ñ</div>
                        <div class="promo-title">AI LAB</div>
                    </div>
                    <div class="promo-desc">Smart Search. Find questions instantly.</div>
                    <button class="btn-start" id="btn-ia-lab-start" style="background:#fff; color:#000;">ASK AI</button>
                </div>

                <div class="card card-metrics square-card-bottom" id="card-activity-log">

                    <!-- SKELETON LOADING -->
                    <div id="activity-skeleton">
                        <div class="metrics-header">
                            <div class="skeleton sk-title" style="width: 100px;"></div>
                        </div>
                        <div style="display:flex; justify-content:center; align-items:center; height:100%; gap:15px;">
                            <div class="skeleton sk-circle" style="width:80px; height:80px;"></div>
                            <div style="flex:1">
                                <div class="skeleton sk-text"></div>
                                <div class="skeleton sk-text" style="width:50%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- REAL CONTENT (Hidden initially) -->
                    <div id="activity-real-content" class="hidden">
                        <div class="metrics-header">
                            <span class="metrics-title">ACTIVITY LOG</span>
                            <span style="font-size:0.8rem; color:#666;">Monthly Rate</span>
                        </div>
                        <div
                            style="display:flex; justify-content:center; align-items:center; height:100%; padding-top:10px;">
                            <div class="activity-pie-chart" id="activity-pie-chart">
                                <div class="activity-pie-inner">
                                    <span id="activity-percent-text">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>

        <div id="learning-view" class="hidden">
            <div class="learning-cards-row">
                <div class="learning-card" id="btn-learn-standalone">
                    <div class="learning-icon">üß†</div>
                    <h3>Stand Alone</h3>
                    <p>Practice specific topics.</p>
                </div>
                <div class="learning-card" id="btn-learn-itemsets">
                    <div class="learning-icon">üîó</div>
                    <h3>Item Sets</h3>
                    <p>Complex scenarios.</p>
                </div>
            </div>
            <button class="btn-back-small" id="btn-back-learning">‚Üê Back to Dashboard</button>
        </div>

        <div id="simulation-view" class="hidden">
            <div class="learning-cards-row">
                <div class="learning-card" id="btn-sim-customize">
                    <div class="learning-icon">üõ†Ô∏è</div>
                    <h3>Customize</h3>
                    <p>Configure your exam.</p>
                </div>
                <div class="learning-card" id="btn-sim-start">
                    <div class="learning-icon">‚ñ∂Ô∏è</div>
                    <h3>Standard Exam</h3>
                    <p>Full INBDE simulation.</p>
                </div>
            </div>
            <button class="btn-back-small" id="btn-back-simulation">‚Üê Back to Dashboard</button>
        </div>

        <div id="pomodoro-view" class="hidden">
            <div class="learning-card" id="btn-pomo-session">
                <div class="learning-icon">üçÖ</div>
                <h3>Start Session</h3>
                <p>25 min Focus / 5 min Break</p>
            </div>

            <button class="pomo-accordion-btn" onclick="togglePomoInfo()">Learn the Pomodoro Technique ‚ñº</button>
            <div id="pomo-info-content" class="pomo-accordion-content hidden">
                <h3 style="color:var(--accent); margin-top:0;">The Pomodoro Technique</h3>
                <p>Stop fighting the clock and start working with it. Here is your complete guide to the productivity
                    method that changed the world.</p>

                <h4>What is it?</h4>
                <p>The Pomodoro Technique is a time management philosophy that aims to provide the user with maximum
                    focus and creative freshness, thereby allowing them to complete projects faster with less mental
                    fatigue.</p>
                <p>The concept is simple: break your workday into 25-minute chunks separated by five-minute breaks.
                    These intervals are referred to as Pomodoros.</p>

                <h4>How It Works (The 6 Steps)</h4>
                <p>Don't overcomplicate it. You only need a timer and a task.</p>

                <ul>
                    <li><strong>1. Pick Your Task:</strong> Select one single task to focus on. Be specific.</li>
                    <li><strong>2. Set the Timer:</strong> Set your timer for 25 minutes. Make a mental oath to focus
                        exclusively.</li>
                    <li><strong>3. Work Until the Ring:</strong> Immerse yourself. Do not switch tasks. If a thought
                        pops up, write it down and continue.</li>
                    <li><strong>4. The Short Break:</strong> When the timer rings, stop immediately. Take 5 minutes.
                        Breathe, stretch. Do NOT check social media.</li>
                    <li><strong>5. Repeat the Cycle:</strong> Go back to Step 2. (1 Cycle = 25m focus + 5m rest).</li>
                    <li><strong>6. The Long Break:</strong> After 4 Pomodoros, take a restorative break of 15-30
                        minutes. Let your brain recover.</li>
                </ul>

                <h4>The Golden Rules</h4>
                <ul>
                    <li><strong>The Indivisible Rule:</strong> A Pomodoro cannot be split up. If interrupted > 1 min,
                        reset.</li>
                    <li><strong>The Batching Rule:</strong> If a task is short, group it with others.</li>
                    <li><strong>The Breakdown Rule:</strong> If a task needs > 5-7 Pomodoros, break it down.</li>
                </ul>

                <h4>Why It Works</h4>
                <ul>
                    <li><strong>Combats Parkinson‚Äôs Law:</strong> Limits time to force efficiency.</li>
                    <li><strong>Eliminates Burnout:</strong> Frequent breaks keep your mind agile.</li>
                    <li><strong>Reduces Anxiety:</strong> You only have to survive the next 25 minutes.</li>
                </ul>
            </div>

            <button class="btn-back-small" id="btn-back-pomodoro">‚Üê Back to Dashboard</button>
        </div>

        <div id="pomodoro-timer-view" class="hidden">
            <h2 style="color:#fff; margin-bottom:20px;">POMODORO FOCUS</h2>
            <div class="pomo-container">
                <div id="timer-display" class="pomo-timer-display">25:00</div>
                <div style="display:flex; gap:20px;">
                    <button class="pomo-btn main" id="btn-pomo-toggle">‚ñ∂</button>
                    <button class="pomo-btn" id="btn-pomo-reset">‚Ü∫</button>
                </div>
            </div>
            <button class="btn-back-small" id="btn-back-timer">Exit</button>
        </div>

        <div id="selection-view" class="hidden">
            <h2 id="selection-mode-title" style="text-transform:uppercase; color:white; margin-bottom:20px;">TOPIC
                SELECTION </h2>
            <div class="selection-container">
                <div class="card-categories">
                    <div class="cat-header" style="padding:20px; border-bottom:1px solid #333;">
                        <h3 style="margin:0;">Subjects</h3>
                    </div>
                    <div id="dynamic-cat-list">Loading...</div>
                </div>

                <div class="card-start-quiz" id="btn-start-quiz-selection">
                    <div class="start-icon" style="font-size:3rem;">üöÄ</div>
                    <h3 style="font-weight:900; margin-top:10px; color:#fff;">START PRACTICE</h3>
                </div>
            </div>
            <button class="btn-back-small" id="btn-back-selection">‚Üê Back</button>
        </div>

        <div id="quiz-settings-modal" class="modal-overlay hidden">
            <div class="modal-content" style="text-align:center;">
                <span class="close-btn" id="btn-close-quiz-settings">√ó</span>
                <h3>Quiz Settings</h3>
                <p style="color:#aaa; margin-bottom:10px;">Select length:</p>
                <select id="quiz-count"
                    style="width:100%; padding:15px; margin:10px 0 20px 0; background:#000; color:#fff; border:1px solid var(--accent); border-radius:8px;">
                </select>
                <button class="btn-start" id="btn-start-quiz-confirm">START NOW</button>
            </div>
        </div>

        <div id="notes-modal" class="modal-overlay hidden">
            <div class="modal-content" style="display:flex; flex-direction:column; height: 80vh; max-height: 600px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="margin:0; color:#fff;">My Quick Notes</h3>
                    <span class="close-btn" id="btn-close-notes-modal">√ó</span>
                </div>

                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <input id="new-note-input" type="text" placeholder="Type a note..."
                        style="flex:1; background:#000; border:1px solid #444; color:white; padding:12px; border-radius:10px; outline:none;">
                    <button id="btn-save-note"
                        style="background:var(--accent); color:black; border:none; border-radius:10px; padding:0 20px; font-weight:bold; cursor:pointer;">SAVE</button>
                </div>

                <div id="notes-list-container" style="flex:1; overflow-y:auto; padding-right:5px; color:#ccc;">
                    Loading notes...
                </div>
            </div>
        </div>

        <div id="ai-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <span class="close-btn" id="btn-close-ai-modal">√ó</span>
                <h3 style="color:#fff;">ü§ñ IA Lab Search</h3>
                <p style="color:#888; font-size:0.9rem;">Type a keyword to find related questions (e.g.,
                    "Ameloblastoma").</p>
                <textarea id="ai-input" class="ai-input-area" placeholder="Search question bank..."></textarea>
                <button class="ai-action-btn" id="btn-ai-submit">Search & Start Quiz</button>
                <div id="ai-output" class="ai-response" style="margin-top:15px; color:#ccc;"></div>
            </div>
        </div>

        <div id="activity-modal" class="modal-overlay hidden">
            <div class="modal-content" style="max-width: 450px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 style="margin:0; color:white;">Activity Log</h3>
                    <span class="close-btn" id="btn-close-activity-modal">√ó</span>
                </div>

                <div class="calendar-header"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; color:white;">
                    <button id="btn-prev-month"
                        style="background:none; border:1px solid #333; color:white; border-radius:5px; cursor:pointer; padding:5px 10px;">&lt;</button>
                    <span id="calendar-month-year" style="font-weight:bold; text-transform:uppercase;">MONTH YEAR</span>
                    <button id="btn-next-month"
                        style="background:none; border:1px solid #333; color:white; border-radius:5px; cursor:pointer; padding:5px 10px;">&gt;</button>
                </div>

                <div id="full-calendar-container" class="calendar-grid">
                </div>

                <div
                    style="margin-top:20px; font-size:0.8rem; color:#888; display:flex; gap:15px; justify-content:center;">
                    <div style="display:flex; align-items:center; gap:5px;"><span
                            style="width:10px; height:10px; background:#10b981; border-radius:2px;"></span> Active</div>
                    <div style="display:flex; align-items:center; gap:5px;"><span
                            style="width:10px; height:10px; background:#ef4444; border-radius:2px;"></span> Missed</div>
                    <div style="display:flex; align-items:center; gap:5px;"><span
                            style="width:10px; height:10px; background:#333; border-radius:2px;"></span> Future</div>
                </div>
            </div>
        </div>

    </div>

    <div id="date-setup-modal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align:center; max-width: 350px;">
            <span class="close-btn" onclick="closeDateModal()">√ó</span>
            <h3 style="color: white; margin-bottom: 10px;">When is your Exam?</h3>
            <p style="color: #999; font-size: 0.9rem; margin-bottom: 20px;">Select your exam date to start the
                countdown.</p>

            <input type="date" id="exam-date-input"
                style="width: 100%; padding: 12px; background: #222; border: 1px solid #444; color: white; border-radius: 8px; font-size: 1rem; margin-bottom: 20px; color-scheme: dark;">

            <button onclick="saveExamDate()"
                style="width: 100%; background: var(--accent); color: black; font-weight: bold; padding: 12px; border: none; border-radius: 8px; cursor: pointer;">
                START COUNTDOWN
            </button>
        </div>
    </div>

    <div id="reset-password-view" class="hidden"
        style="grid-column: 1 / -1; grid-row: 2 / -1; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px; height: 100%;">

        <div class="card" style="max-width: 400px; padding: 40px; text-align: center; background: var(--card-bg-hero);">
            <h2 style="color:var(--accent); margin-bottom:20px;">RESET YOUR PASSWORD</h2>
            <div id="reset-form-content">
                <input type="password" id="new-password" placeholder="New Password"
                    style="width:100%; padding:15px; margin-bottom:15px; background:#000; color:#fff; border:1px solid #333; border-radius:8px;">
                <input type="password" id="confirm-password" placeholder="Confirm Password"
                    style="width:100%; padding:15px; margin-bottom:20px; background:#000; color:#fff; border:1px solid #333; border-radius:8px;">
                <button class="btn-start" id="btn-update-password" onclick="updatePassword()">Update Password</button>
                <div id="reset-msg" style="margin-top:15px; color:#ef4444; font-size:0.9rem;"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>