<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>INBDE Pro Mobile</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
    :root {
        --accent: #facc15; 
        --bg-dark: #000000;
        --card-bg: #0a0a0a;
        --text-main: #ffffff;
        --text-muted: #9ca3af;
        --max-app-width: 480px; /* Ancho m√°ximo est√°ndar de una App m√≥vil */
    }
    
    body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', sans-serif;
        background-color: #111; /* Fondo externo oscuro */
        color: var(--text-main);
        overflow-x: hidden;
        /* Centrar la app en pantallas grandes */
        display: flex;
        justify-content: center;
        min-height: 100vh;
    }

    /* --- MARCO DE LA APP (Simula el m√≥vil en pantallas grandes) --- */
    .mobile-frame {
        width: 100%;
        max-width: var(--max-app-width);
        background-color: var(--bg-dark);
        min-height: 100vh;
        position: relative;
        padding-bottom: 90px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5); /* Sombra sutil a los lados */
    }

    /* --- Clases de Utilidad --- */
    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.4s ease forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* HEADER */
    .app-header {
        padding: 40px 25px 10px 25px;
        background: transparent;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .header-titles { display: flex; flex-direction: column; gap: 2px; }
    .welcome-text { font-size: 0.8rem; color: #666; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
    .brand-text { font-weight: 900; font-size: 1.6rem; color: white; letter-spacing: -0.5px; }
    
    .user-avatar { 
        width: 42px; height: 42px; 
        border-radius: 50%; 
        background: #1a1a1a; 
        border: 1px solid var(--accent); 
        display: flex; align-items: center; justify-content: center; 
        font-size: 1.2rem;
    }

    /* CONTENEDOR PRINCIPAL */
    .app-container {
        padding: 20px;
        display: flex;
        flex-direction: column;
    }

    /* GRID SYSTEM 2x2 BLINDADO */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* Siempre 2 columnas 50% / 50% */
        gap: 15px; 
        margin-top: 10px;
    }

    /* TARJETAS CUADRADAS */
    .square-card {
        border: 2px solid var(--accent);
        border-radius: 22px;
        background: var(--card-bg);
        cursor: pointer;
        aspect-ratio: 1 / 1; /* Forzar cuadrado perfecto siempre */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 10px; /* Padding reducido para pantallas peque√±as */
        text-align: center;
        position: relative;
        transition: transform 0.1s;
    }
    .square-card:active { transform: scale(0.96); background-color: #111; }

    /* CONTENIDO RESPONSIVO DENTRO DE TARJETAS */
    .square-card .icon { 
        /* El tama√±o del icono se ajusta sutilmente seg√∫n el ancho de pantalla (vw) */
        font-size: clamp(2rem, 8vw, 2.8rem); 
        margin-bottom: 10px; 
        filter: drop-shadow(0 0 5px rgba(255,255,255,0.1));
    }
    
    .square-card .label { 
        /* Texto fluido: m√≠nimo 0.8rem, ideal 4vw, m√°ximo 1.1rem */
        font-size: clamp(0.8rem, 4.5vw, 1.1rem); 
        font-weight: 800; 
        color: white; 
        text-transform: uppercase;
        letter-spacing: 0.5px; 
        line-height: 1.1;
    }
    
    .square-card .sub { 
        font-size: clamp(0.6rem, 2.5vw, 0.75rem);
        color: var(--text-muted); 
        margin-top: 4px; 
        font-weight: 500;
        white-space: nowrap; /* Evitar que el subt√≠tulo se rompa en dos l√≠neas */
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
    }

    /* BOTTOM NAV FIJO Y CENTRADO */
    .bottom-nav {
        position: fixed; 
        bottom: 0; 
        height: 75px;
        width: 100%;
        max-width: var(--max-app-width); /* No exceder el ancho del frame */
        background: black; 
        border-top: 1px solid #222;
        display: flex; 
        justify-content: space-around; 
        align-items: center;
        z-index: 100; 
        padding-bottom: 15px;
        /* Truco para centrar elemento fixed dentro de un layout centrado */
        left: 50%;
        transform: translateX(-50%);
    }
    .nav-item { color: #555; font-size: 0.65rem; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 6px; text-decoration: none; }
    .nav-item.active { color: white; }
    .nav-icon { font-size: 1.4rem; }

    /* ESTILOS INTERNOS (Vistas secundarias) */
    .learning-cards-row { display: flex; flex-direction: column; gap: 15px; width: 100%; }
    .learning-card { background: #111; border: 1px solid #333; border-radius: 16px; padding: 20px; text-align: center; color: white; margin-bottom:10px;}
    .btn-back-small { background: transparent; border: 1px solid #333; color: #888; padding: 12px; border-radius: 12px; margin-top: 10px; width: 100%; font-weight: 600; cursor: pointer; }
    #dynamic-cat-list { color: white; }

    /* MODALES */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
    .modal-overlay.active { opacity: 1; pointer-events: auto; }
    .modal-content { background: #121212; border: 1px solid #333; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
    .close-btn { float: right; cursor: pointer; font-size: 1.5rem; color: #666; }
    
    /* Botones de Modal */
    .btn-start { display: block; width: 100%; background: var(--accent); color: #000; font-weight: 900; font-size: 0.85rem; padding: 12px 0; border-radius: 8px; text-transform: uppercase; letter-spacing: 1px; text-align: center; border: none; cursor: pointer; transition: transform 0.1s; }
</style>
</head>
<body>

    <div class="mobile-frame">

        <header class="app-header">
            <div class="header-titles">
                <div class="welcome-text">WELCOME</div>
                <div class="brand-text">Doctor <span style="color:var(--accent);">Pro</span></div>
            </div>
            <div class="user-avatar" onclick="logout()">üë®‚Äç‚öïÔ∏è</div>
        </header>

        <div id="dashboard-content" class="app-container fade-in">
            <div class="dashboard-grid">
                <div class="square-card" onclick="showLearningLab()">
                    <div class="icon">üß™</div>
                    <div class="label">Study</div>
                    <div class="sub">Deep Dive</div>
                </div>
                <div class="square-card" onclick="showSimulationLab()">
                    <div class="icon">‚ö°</div>
                    <div class="label">Simulate</div>
                    <div class="sub">Exam Mode</div>
                </div>
                <div class="square-card" onclick="startDailyRun()">
                    <div class="icon">üî•</div>
                    <div class="label">Daily Run</div>
                    <div class="sub">10-Q Sprint</div> 
                </div>
                <div class="square-card" onclick="alert('Coming Soon')">
                    <div class="icon" style="color:var(--accent);">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line></svg>
                    </div>
                    <div class="label">Method</div>
                    <div class="sub">Our Way</div>
                </div>
            </div>
        </div>

        <div id="learning-view" class="app-container hidden">
            <h2 style="color:white; margin:0 0 20px 0;">Study Mode</h2>
            <div class="learning-cards-row">
                <div class="learning-card" onclick="openSelectionView('standalone')"><h3>üß† Stand Alone</h3></div>
                <div class="learning-card" onclick="openSelectionView('itemsets')"><h3>üîó Item Sets</h3></div>
            </div>
            <button class="btn-back-small" onclick="goBackToDashboard()">Back Home</button>
        </div>

        <div id="simulation-view" class="app-container hidden">
            <h2 style="color:white; margin:0 0 20px 0;">Simulation Lab</h2>
            <div class="learning-cards-row">
                <div class="learning-card" onclick="openSelectionView('simulation')"><h3>üõ†Ô∏è Customize</h3></div>
                <div class="learning-card" onclick="startQuizEngine('simulation_standard')"><h3>‚ñ∂Ô∏è Standard Exam</h3></div>
            </div>
            <button class="btn-back-small" onclick="goBackToDashboard()">Back Home</button>
        </div>

        <div id="selection-view" class="app-container hidden">
            <h2 id="selection-mode-title" style="color:white;">Topics</h2>
            <div id="dynamic-cat-list"></div> 
            <button class="square-card" style="width:100%; aspect-ratio:auto; height:60px; flex-direction:row; margin-top:20px; border-radius:12px;" onclick="openQuizSettings()">
                <span style="font-weight:bold; color:white;">NEXT STEP ‚Üí</span>
            </button>
            <button class="btn-back-small" onclick="goBackToLearning()">Cancel</button>
        </div>

        <nav class="bottom-nav">
            <a href="#" class="nav-item active" onclick="goBackToDashboard()">
                <span class="nav-icon">üè†</span><span>Home</span>
            </a>
            <a href="stats.html" class="nav-item">
                <span class="nav-icon">üìä</span><span>Stats</span>
            </a>
            <a href="#" class="nav-item" onclick="openNotesModal()">
                <span class="nav-icon">üìù</span><span>Notes</span>
            </a>
            <a href="#" class="nav-item" onclick="logout()">
                <span class="nav-icon">‚öôÔ∏è</span><span>Profile</span>
            </a>
        </nav>

    </div> 

    <div id="quiz-settings-modal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align:center;">
            <span class="close-btn" onclick="closeQuizSettings()">√ó</span>
            <h3>Quiz Settings</h3>
            <p style="color:#aaa; margin-bottom:10px;">Select length:</p>
            <select id="quiz-count" style="width:100%; padding:15px; margin:10px 0 20px 0; background:#000; color:#fff; border:1px solid var(--accent); border-radius:8px;">
                </select>
            <button class="btn-start" onclick="startQuiz()">START NOW</button>
        </div>
    </div>

    <div id="notes-modal" class="modal-overlay hidden">
        <div class="modal-content" style="background:#121214; border:1px solid #333; padding:20px; width:90%; max-width:500px; height:80vh; border-radius:20px; display:flex; flex-direction:column; box-shadow:0 0 20px rgba(0,0,0,0.8);">
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; color:white;">
                <h3 style="margin:0; font-weight:800; font-size:1.2rem;">My Quick Notes</h3>
                <span onclick="closeNotesModal()" style="cursor:pointer; font-size:1.8rem; color:#666;">&times;</span>
            </div>

            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input id="new-note-input" type="text" placeholder="Type a note..." style="flex:1; background:#000; border:1px solid #444; color:white; padding:12px; border-radius:10px; outline:none;">
                <button onclick="saveNote()" style="background:var(--accent); color:black; border:none; border-radius:10px; padding:0 15px; font-weight:bold; cursor:pointer;">SAVE</button>
            </div>

            <div id="notes-list-container" style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:10px; padding-right:5px;">
                Loading notes...
            </div>
        </div>
    </div>

    <div id="ai-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAIModal()">√ó</span>
            <h3>ü§ñ IA Lab Search</h3>
            <p style="color:#888; font-size:0.9rem;">Type a keyword (e.g., "Ameloblastoma").</p>
            <textarea id="ai-input" class="ai-input-area" style="width:100%; background:#000; border:1px solid #333; color:white; padding:10px; border-radius:8px;" placeholder="Search..."></textarea>
            <button class="btn-start" onclick="callGemini()" style="margin-top:15px;">Search</button>
            <div id="ai-output" style="margin-top:15px; color:#ccc;"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
